//
// Copyright shilon5
// Virtual Angular 1.x Repeat
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:a.pageYOffset,scrollLeft:a.pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(a,b){return 0-h(a,b)}function g(b){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(b):setTimeout(b,0)}function h(b,c){if(a.getComputedStyle){var d=getComputedStyle(b),e=d.transform||d.webkitTransform||d.mozTransform,f=e&&e.match(/^matrix3d\((.+)\)$/);return f?parseFloat(f[1].split(", ")[c?12:13]):(f=e&&e.match(/^matrix\((.+)\)$/),f?parseFloat(f[1].split(", ")[c?4:5]):0)}}function i(b,d,e){return b.getBoundingClientRect()[e?"left":"top"]-(d===a?0:d.getBoundingClientRect()[e?"left":"top"])+(d===a?c():d)[e?"scrollLeft":"scrollTop"]}var j=document.documentElement,k=j.matches?"matches":j.matchesSelector?"matchesSelector":j.webkitMatches?"webkitMatches":j.webkitMatchesSelector?"webkitMatchesSelector":j.msMatches?"msMatches":j.msMatchesSelector?"msMatchesSelector":j.mozMatches?"mozMatches":j.mozMatchesSelector?"mozMatchesSelector":null,l=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[k](a);)c=c.parentNode;return c&&c[k](a)?b.element(c):b.element()},m=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,h){return{restrict:"A",scope:!0,compile:function(j,k){var m,n,o,p,q,r,s=b.isDefined(k.vsRepeatContainer)?b.element(j[0].querySelector(k.vsRepeatContainer)):j,t=s.children().eq(0),u=t[0].outerHTML,v="$vs_collection",w=!1,x={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsScrolledToBeginningOffset:"scrolledToBeginningOffset",vsExcess:"excess"};if(t.attr("ng-repeat"))r="ng-repeat",m=t.attr("ng-repeat");else if(t.attr("data-ng-repeat"))r="data-ng-repeat",m=t.attr("data-ng-repeat");else if(t.attr("ng-repeat-start"))w=!0,r="ng-repeat-start",m=t.attr("ng-repeat-start");else{if(!t.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");w=!0,r="data-ng-repeat-start",m=t.attr("data-ng-repeat-start")}if(n=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(m),o=n[1],p=n[2],q=n[3],w)for(var y=0,z=s.children().eq(0);null==z.attr("ng-repeat-end")&&null==z.attr("data-ng-repeat-end");)y++,z=s.children().eq(y),u+=z[0].outerHTML;return s.empty(),{pre:function(j,k,m,n,s){function t(){if(!K||K.length<1)j[v]=[],G=0,j.sizesCumulative=[0];else if(G=K.length,P){j.sizes=K.map(function(a){var c=j.$new(!1);b.extend(c,a),c[o]=a;var d=m.vsSize||m.vsSizeProperty?c.$eval(m.vsSize||m.vsSizeProperty):j.elementSize;return c.$destroy(),d});var a=0;j.sizesCumulative=j.sizes.map(function(b){var c=a;return a+=b,c}),j.sizesCumulative.push(a)}else y();C()}function y(){O&&j.$$postDigest(function(){if(H[0].offsetHeight||H[0].offsetWidth){for(var a=H.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[r]||d){if(c||(j.elementSize=0),c=!0,a[b][T]&&(j.elementSize+=a[b][T]),!w)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(C(),O=!1,j.$root&&!j.$root.$$phase&&j.$apply())}else var e=j.$watch(function(){(H[0].offsetHeight||H[0].offsetWidth)&&(e(),y())})})}function z(){var a="tr"===J?"":"min-";return L?a+"width":a+"height"}function A(){if(F()){j.$digest();var a=P?j.sizesCumulative[G]:j.elementSize*G;a!==k[0].clientHeight&&console.warn("vsRepeat: size mismatch. Expected size "+a+"px whereas actual size is "+k[0].clientHeight+"px. Fix vsSize on element:",k[0])}}function B(){void 0!==m.vsAutoresize&&(O=!0,y(),j.$root&&!j.$root.$$phase&&j.$apply()),F()&&j.$apply()}function C(){X=void 0,Y=void 0,Z=G,$=0,D(P?j.sizesCumulative[G]:j.elementSize*G),g(function(){F(),j.$emit("vsRepeatReinitialized",j.startIndex,j.endIndex)})}function D(a){j.totalSize=j.offsetBefore+a+j.offsetAfter}function E(){var a=d(Q[0],S);a!==aa&&(C(),j.$root&&!j.$root.$$phase&&j.$apply()),aa=a}function F(){var a=d(Q[0],S),b=H[0]===Q[0]?0:i(H[0],Q[0],L),c=V?f(Q[0],L):e(Q[0],U),k=j.startIndex,l=j.endIndex;if(P){for(k=0;j.sizesCumulative[k]<c-j.offsetBefore-b;)k++;for(k>0&&k--,k=Math.max(Math.floor(k-j.excess/2),0),l=k;j.sizesCumulative[l]<c-j.offsetBefore-b+a;)l++;l=Math.min(Math.ceil(l+j.excess/2),G)}else k=Math.max(Math.floor((c-j.offsetBefore-b)/j.elementSize)-j.excess/2,0),l=Math.min(k+Math.ceil(a/j.elementSize)+j.excess,G);Z=Math.min(k,Z),$=Math.max(l,$),j.startIndex=R.latch?Z:k,j.endIndex=R.latch?$:l,$<j.startIndex&&(j.startIndex=$);var n=!1;if(null==X?n=!0:null==Y&&(n=!0),n||(R.hunked?Math.abs(j.startIndex-X)>=j.excess/2||0===j.startIndex&&0!==X?n=!0:(Math.abs(j.endIndex-Y)>=j.excess/2||j.endIndex===G&&Y!==G)&&(n=!0):n=j.startIndex!==X||j.endIndex!==Y),n){j[v]=K.slice(j.startIndex,j.endIndex),j.$emit("vsRepeatInnerCollectionUpdated",j.startIndex,j.endIndex,X,Y);var o;m.vsScrolledToEnd&&(o=K.length-(j.scrolledToEndOffset||0),(j.endIndex>=o&&Y<o||K.length&&j.endIndex===K.length)&&j.$eval(m.vsScrolledToEnd)),m.vsScrolledToBeginning&&(o=j.scrolledToBeginningOffset||0,j.startIndex<=o&&X>j.startIndex&&j.$eval(m.vsScrolledToBeginning)),X=j.startIndex,Y=j.endIndex;var p=P?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",q=h(p),r=q(j,{$index:0}),s=q(j,{$index:j[v].length}),t=j.totalSize;g(function(){M.css(z(),r+"px"),N.css(z(),t-s+"px")})}return n}var G,H=b.isDefined(m.vsRepeatContainer)?b.element(k[0].querySelector(m.vsRepeatContainer)):k,I=b.element(u),J=I[0].tagName.toLowerCase(),K=[],L=void 0!==m.vsHorizontal,M=b.element("<"+J+' class="vs-repeat-before-content"></'+J+">"),N=b.element("<"+J+' class="vs-repeat-after-content"></'+J+">"),O=!m.vsRepeat,P=!!m.vsSize||!!m.vsSizeProperty,Q=m.vsScrollParent?"window"===m.vsScrollParent?b.element(a):l.call(H,m.vsScrollParent):H,R="vsOptions"in m?j.$eval(m.vsOptions):{},S=L?"clientWidth":"clientHeight",T=L?"offsetWidth":"offsetHeight",U=L?"scrollLeft":"scrollTop",V=void 0!==m.vsTranslateMode;if(j.totalSize=0,!("vsSize"in m)&&"vsSizeProperty"in m&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===Q.length)throw"Specified scroll parent selector did not match any element";j.$scrollParent=Q,P&&(j.sizesCumulative=[]),j.elementSize=+m.vsRepeat||d(Q[0],S)||50,j.offsetBefore=0,j.offsetAfter=0,j.excess=2,L?(M.css("height","100%"),N.css("height","100%")):(M.css("width","100%"),N.css("width","100%")),Object.keys(x).forEach(function(a){m[a]&&m.$observe(a,function(b){j[x[a]]=+b,C()})}),j.$watchCollection(p,function(a){K=a||[],t()}),I.eq(0).attr(r,o+" in "+v+(q?" "+q:"")),I.addClass("vs-repeat-repeated-element"),H.append(M),H.append(I),c(I)(j,null,{parentBoundTranscludeFn:s}),H.append(N),j.startIndex=0,j.endIndex=0,Q.on("scroll",A);var W=_.debounce(function(){B()},300);"function"==typeof a.addResizeListener&&a.addResizeListener(k[0],W),b.element(a).on("resize",B),j.$on("$destroy",function(){b.element(a).off("resize",B),"function"==typeof a.removeResizeListener&&a.removeResizeListener(k[0],W),Q.off("scroll",A)}),j.$on("vsRepeatTrigger",t),j.$on("vsRepeatResize",function(){O=!0,y()});var X,Y,Z,$;j.$on("vsRenderAll",function(){R.latch&&setTimeout(function(){var a=G;$=Math.max(a,$),j.endIndex=R.latch?$:a,j[v]=K.slice(j.startIndex,j.endIndex),Y=j.endIndex,j.$$postDigest(function(){M.css(z(),0),N.css(z(),0)}),j.$apply(function(){j.$emit("vsRenderAllDone")})})});var aa;j.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(E):E()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=m.name)}(window,window.angular);