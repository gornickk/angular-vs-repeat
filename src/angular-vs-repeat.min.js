//
// Copyright shilon5
// Virtual Angular 1.x Repeat
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(a,b){return 0-g(a,b)}function g(b,c){if(a.getComputedStyle){var d=getComputedStyle(b),e=d.transform||d.webkitTransform||d.mozTransform,f=e&&e.match(/^matrix3d\((.+)\)$/);return f?parseFloat(f[1].split(", ")[c?12:13]):(f=e&&e.match(/^matrix\((.+)\)$/),f?parseFloat(f[1].split(", ")[c?4:5]):0)}}function h(b,d,e){return b.getBoundingClientRect()[e?"left":"top"]-(d===a?0:d.getBoundingClientRect()[e?"left":"top"])+(d===a?c():d)[e?"scrollLeft":"scrollTop"]}var i=document.documentElement,j=i.matches?"matches":i.matchesSelector?"matchesSelector":i.webkitMatches?"webkitMatches":i.webkitMatchesSelector?"webkitMatchesSelector":i.msMatches?"msMatches":i.msMatchesSelector?"msMatchesSelector":i.mozMatches?"mozMatches":i.mozMatchesSelector?"mozMatchesSelector":null,k=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[j](a);)c=c.parentNode;return c&&c[j](a)?b.element(c):b.element()},l=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,g){return{restrict:"A",scope:!0,compile:function(i,j){var l,m,n,o,p,q,r=b.isDefined(j.vsRepeatContainer)?b.element(i[0].querySelector(j.vsRepeatContainer)):i,s=r.children().eq(0),t=s[0].outerHTML,u="$vs_collection",v=!1,w={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsExcess:"excess"};if(s.attr("ng-repeat"))q="ng-repeat",l=s.attr("ng-repeat");else if(s.attr("data-ng-repeat"))q="data-ng-repeat",l=s.attr("data-ng-repeat");else if(s.attr("ng-repeat-start"))v=!0,q="ng-repeat-start",l=s.attr("ng-repeat-start");else{if(!s.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");v=!0,q="data-ng-repeat-start",l=s.attr("data-ng-repeat-start")}if(m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(l),n=m[1],o=m[2],p=m[3],v)for(var x=0,y=r.children().eq(0);null==y.attr("ng-repeat-end")&&null==y.attr("data-ng-repeat-end");)x++,y=r.children().eq(x),t+=y[0].outerHTML;return r.empty(),{pre:function(i,j,l){function m(){if(!G||G.length<1)i[u]=[],C=0,i.sizesCumulative=[0];else if(C=G.length,L){i.sizes=G.map(function(a){var c=i.$new(!1);b.extend(c,a),c[n]=a;var d=l.vsSize||l.vsSizeProperty?c.$eval(l.vsSize||l.vsSizeProperty):i.elementSize;return c.$destroy(),d});var a=0;i.sizesCumulative=i.sizes.map(function(b){var c=a;return a+=b,c}),i.sizesCumulative.push(a)}else r();z()}function r(){K&&i.$$postDigest(function(){if(D[0].offsetHeight||D[0].offsetWidth){for(var a=D.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[q]||d){if(c||(i.elementSize=0),c=!0,a[b][P]&&(i.elementSize+=a[b][P]),!v)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(z(),K=!1,i.$root&&!i.$root.$$phase&&i.$apply())}else var e=i.$watch(function(){(D[0].offsetHeight||D[0].offsetWidth)&&(e(),r())})})}function s(){var a="tr"===F?"":"min-";return H?a+"width":a+"height"}function x(){B()&&i.$digest()}function y(){void 0!==l.vsAutoresize&&(K=!0,r(),i.$root&&!i.$root.$$phase&&i.$apply()),B()&&i.$apply()}function z(){T=void 0,U=void 0,V=C,W=0;i.totalSize;A(L?i.sizesCumulative[C]:i.elementSize*C),B(),i.$scrollParent&&i.$scrollParent.scrollTop()>i.totalSize&&i.$scrollParent&&i.$scrollParent.scrollTop(Math.max(0,i.totalSize)),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function A(a){i.totalSize=i.offsetBefore+a+i.offsetAfter}function B(){var a=R?f(M[0],H):e(M[0],Q),b=d(M[0],O),c=D[0]===M[0]?0:h(D[0],M[0],H),j=i.startIndex,k=i.endIndex;if(L){for(j=0;i.sizesCumulative[j]<a-i.offsetBefore-c;)j++;for(j>0&&j--,j=Math.max(Math.floor(j-i.excess/2),0),k=j;i.sizesCumulative[k]<a-i.offsetBefore-c+b;)k++;k=Math.min(Math.ceil(k+i.excess/2),C)}else j=Math.max(Math.floor((a-i.offsetBefore-c)/i.elementSize)-i.excess/2,0),k=Math.min(j+Math.ceil(b/i.elementSize)+i.excess,C);V=Math.min(j,V),W=Math.max(k,W),i.startIndex=N.latch?V:j,i.endIndex=N.latch?W:k;var m=!1;if(null==T?m=!0:null==U&&(m=!0),m||(N.hunked?Math.abs(i.startIndex-T)>=i.excess/2||0===i.startIndex&&0!==T?m=!0:(Math.abs(i.endIndex-U)>=i.excess/2||i.endIndex===C&&U!==C)&&(m=!0):m=i.startIndex!==T||i.endIndex!==U),m){if(i[u]=G.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,T,U),l.vsScrolledToEnd){var n=G.length-(i.scrolledToEndOffset||0);(i.endIndex>=n&&U<n||G.length&&i.endIndex===G.length)&&i.$eval(l.vsScrolledToEnd)}T=i.startIndex,U=i.endIndex;var o=L?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",p=g(o),q=p(i,{$index:0}),r=p(i,{$index:i[u].length}),t=i.totalSize;I.css(s(),q+"px"),J.css(s(),t-r+"px")}return m}var C,D=b.isDefined(l.vsRepeatContainer)?b.element(j[0].querySelector(l.vsRepeatContainer)):j,E=b.element(t),F=E[0].tagName.toLowerCase(),G=[],H=void 0!==l.vsHorizontal,I=b.element("<"+F+' class="vs-repeat-before-content"></'+F+">"),J=b.element("<"+F+' class="vs-repeat-after-content"></'+F+">"),K=!l.vsRepeat,L=!!l.vsSize||!!l.vsSizeProperty,M=l.vsScrollParent?"window"===l.vsScrollParent?b.element(a):k.call(D,l.vsScrollParent):D,N="vsOptions"in l?i.$eval(l.vsOptions):{},O=H?"clientWidth":"clientHeight",P=H?"offsetWidth":"offsetHeight",Q=H?"scrollLeft":"scrollTop",R=void 0!==l.vsTranslateMode;if(i.totalSize=0,!("vsSize"in l)&&"vsSizeProperty"in l&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===M.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=M,L&&(i.sizesCumulative=[]),i.elementSize=+l.vsRepeat||d(M[0],O)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,H?(I.css("height","100%"),J.css("height","100%")):(I.css("width","100%"),J.css("width","100%")),Object.keys(w).forEach(function(a){l[a]&&l.$observe(a,function(b){i[w[a]]=+b,z()})}),i.$watchCollection(o,function(a){G=a||[],m()}),E.eq(0).attr(q,n+" in "+u+(p?" "+p:"")),E.addClass("vs-repeat-repeated-element"),D.append(I),D.append(E),c(E)(i),D.append(J),i.startIndex=0,i.endIndex=0,M.on("scroll",x);var S=_.debounce(function(){y()},300);b.element(a).on("resize",y),i.$on("$destroy",function(){b.element(a).off("resize",y),"function"==typeof a.removeResizeListener&&a.removeResizeListener(j[0],S),M.off("scroll",x)}),i.$on("vsRepeatTrigger",m),i.$on("vsRepeatResize",function(){K=!0,r()});var T,U,V,W;i.$on("vsRenderAll",function(){N.latch&&setTimeout(function(){var a=C;W=Math.max(a,W),i.endIndex=N.latch?W:a,i[u]=G.slice(i.startIndex,i.endIndex),U=i.endIndex,i.$$postDigest(function(){I.css(s(),0),J.css(s(),0)}),i.$apply(function(){i.$emit("vsRenderAllDone")})})})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=l.name)}(window,window.angular);